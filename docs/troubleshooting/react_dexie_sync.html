<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React & Dexie íŠ¸ëŸ¬ë¸”ìŠˆíŒ…: Stale Prop ë™ê¸°í™” ë¬¸ì œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f1f5f9;
        }
        .timeline-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        /* ìƒ‰ìƒ ë³€ê²½: íŠ¸ëŸ¬ë¸”ìŠˆíŒ…/í•´ê²° ì£¼ì œì— ë§ê²Œ íŒŒë€ìƒ‰ ê³„ì—´ë¡œ ë³€ê²½ */
        .timeline-item.active {
            background-color: #3b82f6; /* íŒŒë€ìƒ‰ */
            color: white;
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .timeline-item.active .timeline-phase {
            color: white;
        }
        .timeline-item:not(.active):hover {
            background-color: #eff6ff; /* ì—°í•œ íŒŒë€ìƒ‰ ê³„ì—´ */
            transform: translateY(-2px);
        }
        .content-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            font-family: 'Courier New', Courier, monospace;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-size: 0.875rem;
        }
        .text-error { color: #dc3545; }
        .text-success { color: #3b82f6; } /* íŒŒë€ìƒ‰ ì„±ê³µ í‘œì‹œ */
    </style>
</head>
<body class="text-slate-800">

    <main class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">React & Dexie: Stale Prop ë™ê¸°í™” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…</h1>
            <p class="mt-2 text-lg text-slate-600">DB ë¹„ë™ê¸° ì—…ë°ì´íŠ¸ í›„ UIê°€ ë°˜ì˜ë˜ì§€ ì•Šê±°ë‚˜ ìƒˆë¡œê³ ì¹¨ ì‹œ ì´ˆê¸°í™”ë˜ëŠ” ë¬¸ì œ í•´ê²° ê¸°ë¡.</p>
        </header>

        <nav id="timeline-nav" class="flex flex-col md:flex-row justify-center items-center gap-2 md:gap-4 mb-12">
            </nav>

        <div id="content-area">
            </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const timelineNav = document.getElementById('timeline-nav');
            const contentArea = document.getElementById('content-area');
            let currentPhaseIndex = 0;

            const caseFiles = [
                {
                    phase: "Phase 1",
                    title: "ë¬¸ì œ ì •ì˜ ë° ì´ˆê¸° ê°€ì„¤",
                    icon: "ğŸ”¥",
                    content: {
                        symptom: "ìì‹ ì»´í¬ë„ŒíŠ¸ì˜ `useCallback` í•¨ìˆ˜ì—ì„œ Dexie DB ì—…ë°ì´íŠ¸ë¥¼ ì„±ê³µí–ˆìœ¼ë‚˜, <span class='text-error'>UIì— ë°˜ì˜ë˜ì§€ ì•Šê±°ë‚˜</span> ìƒˆë¡œê³ ì¹¨ ì‹œ `null` ê°’ìœ¼ë¡œ ë˜ëŒì•„ê°.",
                        hypothesis: "ìƒíƒœ ë¶ˆë³€ì„±(`setGroupData`) ë¡œì§ì— ë¬¸ì œê°€ ìˆê±°ë‚˜, `useCallback`ì´ ì˜¤ë˜ëœ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ëŠ” í´ë¡œì €(Closure) ë¬¸ì œì¼ ê²ƒì´ë‹¤.",
                        investigation: [
                            "`setGroupData(prev => {...})` íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ë¶ˆë³€ì„± ì›ì¹™ì„ ì¤€ìˆ˜í–ˆìŒì„ í™•ì¸.",
                            "`console.log`ë¡œ `setGroupData` ì§í›„ ìƒˆ ìƒíƒœëŠ” ì˜¬ë°”ë¥´ê²Œ ë³€ê²½ë˜ì—ˆìŒì„ í™•ì¸.",
                            "ê²°ë¡ : ìƒíƒœ ì—…ë°ì´íŠ¸ ìì²´ëŠ” ì„±ê³µí–ˆìœ¼ë‚˜, ë‹¤ë¥¸ ë¡œì§ì´ ì´ ê°’ì„ ë®ì–´ì“°ê³  ìˆìŒ."
                        ],
                        breakthrough: "ë¬¸ì œëŠ” **ìƒíƒœ ì—…ë°ì´íŠ¸ ìì²´ê°€ ì•„ë‹Œ** <span class='text-success'>ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ë¡œì§</span>ì— ìˆìŒì„ íŒŒì•…."
                    }
                },
                {
                    phase: "Phase 2",
                    title: "ë‹¨ì¼ ì§„ì‹¤ ê·¼ì›(SSOT) ì¶©ëŒ",
                    icon: "ğŸš¨",
                    content: {
                        symptom: "ìƒˆë¡œê³ ì¹¨ ì‹œ `useEffect`ê°€ ì‹¤í–‰ë˜ë©°, `useCallback`ì—ì„œ DBì— ì €ì¥í•œ ìµœì‹  ìƒíƒœê°€ `null` ê°’ìœ¼ë¡œ ë®ì–´ì”Œì›Œì§.",
                        hypothesis: "ë¶€ëª¨ì—ê²Œì„œ ë°›ëŠ” `orders` Propì´ DBì˜ ìµœì‹  ìƒíƒœë¥¼ ë°˜ì˜í•˜ì§€ ëª»í•˜ê³ , ì´ Propì´ `useEffect`ë¥¼ í†µí•´ ë¡œì»¬ ìƒíƒœë¥¼ ê°•ì œë¡œ ì´ˆê¸°í™”í•˜ê³  ìˆë‹¤.",
                        investigation: [
                            "ìì‹ì˜ DB ì—…ë°ì´íŠ¸ê°€ ë¶€ëª¨ì˜ `orders` Propì„ ë³€ê²½ì‹œí‚¤ì§€ ëª»í•˜ëŠ” **React ë‹¨ë°©í–¥ ë°ì´í„° íë¦„** í™•ì¸.",
                            "`useEffect([orders])`ëŠ” Propì´ ë°”ë€” ë•Œë§ˆë‹¤ ì‹¤í–‰ë˜ì–´, ì˜¤ë˜ëœ `orders` Propì„ ê¸°ë°˜ìœ¼ë¡œ `groupData`ë¥¼ ì¬ì´ˆê¸°í™”í•˜ê³  ìˆì—ˆìŒ.",
                            "ê²°ê³¼: **DB (Local) vs. Prop (Parent)** ê°„ì˜ ë°ì´í„° ë™ê¸°í™” ë¶ˆì¼ì¹˜ê°€ ê·¼ë³¸ ì›ì¸."
                        ],
                        breakthrough: "ìì‹ì˜ DB ì—…ë°ì´íŠ¸ í›„ **<span class='text-success'>ë¶€ëª¨ì˜ `orders` Prop</span>**ì„ ê°•ì œë¡œ ìµœì‹ í™”í•´ì•¼ í•œë‹¤ëŠ” ì „ëµì  ëª©í‘œ ì„¤ì •."
                    }
                },
                {
                    phase: "Phase 3",
                    title: "`useQuery` Refetchë¥¼ í†µí•œ Prop ë™ê¸°í™”",
                    icon: "ğŸ”„",
                    content: {
                        symptom: "Propsë¥¼ ë™ê¸°í™”í•˜ê¸° ìœ„í•´ ë¶€ëª¨ì—ê²Œ ìƒˆë¡œìš´ ê°±ì‹  í•¨ìˆ˜ë¥¼ ìš”ì²­í•´ì•¼ í•˜ëŠ” ìƒí™©. ê¸°ì¡´ì— `useQuery` ì‚¬ìš© ì¤‘.",
                        hypothesis: "ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ê°€ `useQuery`ì—ì„œ ì œê³µí•˜ëŠ” `refetch` í•¨ìˆ˜ë¥¼ ìì‹ì—ê²Œ Propsë¡œ ì „ë‹¬í•˜ì—¬ ê°±ì‹  ì‹ í˜¸ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.",
                        investigation: [
                            "ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ `refetch` í•¨ìˆ˜ë¥¼ `onOrdersUpdate` Propìœ¼ë¡œ ìì‹ì—ê²Œ ì „ë‹¬í•˜ë„ë¡ êµ¬ì¡° ë³€ê²½.",
                            "ìì‹ ì»´í¬ë„ŒíŠ¸ì˜ `useCallback` ë‚´ë¶€ì—ì„œ Dexie ì—…ë°ì´íŠ¸ ì„±ê³µ ì§í›„, `onOrdersUpdate()` (ì¦‰, `refetch`) í˜¸ì¶œ ë¡œì§ ì¶”ê°€.",
                            "ê²°ê³¼: `refetch` í˜¸ì¶œë¡œ ë¶€ëª¨ì˜ `useQuery`ê°€ DBì˜ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´. ì´ëŠ” ê³§ë°”ë¡œ ìì‹ì˜ `orders` Prop ë³€ê²½ìœ¼ë¡œ ì´ì–´ì§."
                        ],
                        breakthrough: "DB ë³€ê²½ í›„ **`onOrdersUpdate()`** í˜¸ì¶œì„ í†µí•´ **<span class='text-success'>ë¶€ëª¨-ìì‹ ì»´í¬ë„ŒíŠ¸ ê°„ì˜ ìƒíƒœ ë™ê¸°í™” íŒŒì´í”„ë¼ì¸</span>**ì„ êµ¬ì¶•."
                    }
                },
                {
                    phase: "Phase 4",
                    title: "ìµœì¢… ê²°ë¡  ë° ê¸°ëŒ€ íš¨ê³¼",
                    icon: "âœ…",
                    content: {
                        symptom: "`refetch` í•¨ìˆ˜ í˜¸ì¶œë§Œìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ ë¬¸ì œ ë° ì‹¤ì‹œê°„ ë°˜ì˜ ë¬¸ì œê°€ ëª¨ë‘ í•´ê²°ë¨.",
                        hypothesis: "ë¹„ë™ê¸° DB/API ì—…ë°ì´íŠ¸ ì‹œ, ë¡œì»¬ ìƒíƒœë¥¼ ì§ì ‘ ì¡°ì‘í•˜ê¸°ë³´ë‹¤ **ë°ì´í„° ì†ŒìŠ¤(Prop)ë¥¼ ê°±ì‹ **í•˜ëŠ” ê²ƒì´ Reactì˜ ì •ì„ íŒ¨í„´ì´ë‹¤.",
                        investigation: [
                            "DB I/O (Dexie) í›„ `refetch`ë¡œ ì¸í•œ ë¶€ëª¨ Prop ê°±ì‹  -> ìì‹ `useEffect([orders])` ì‹¤í–‰ -> `groupData` ì˜¬ë°”ë¥´ê²Œ ê°±ì‹ ë˜ëŠ” ì™„ì „í•œ ì‚¬ì´í´ í™•ì¸.",
                            "Year/Month ë³€ê²½ ì‹œ `useQuery`ì˜ ìë™ refetch ê¸°ëŠ¥ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ë¨.",
                            "ê²°ë¡ : `refetch`ë¥¼ í†µí•œ Prop ë™ê¸°í™”ëŠ” **ë‹¨ì¼ ì§„ì‹¤ ê·¼ì›(SSOT)**ì„ ì¤‘ì•™(Parent)ì— ë‘ëŠ” ì‹¤ë¬´ì ì¸ ìµœì ì˜ í•´ê²°ì±…."
                        ],
                        breakthrough: "<strong>`useQuery`ì˜ `refetch` í•¨ìˆ˜ë¥¼ í†µí•œ Prop ë™ê¸°í™” ì „ëµì„ ìµœì¢… ì±„íƒ.</strong> Reactì˜ ë¹„ë™ê¸° í™˜ê²½ì—ì„œ ì™¸ë¶€ ë°ì´í„° ì €ì¥ì†Œ(Dexie)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê°€ì¥ ëª¨ë²”ì ì´ê³  ì•ˆì •ì ì¸ ì•„í‚¤í…ì²˜ êµ¬ì¶•."
                    }
                }
            ];

            function render() {
                // íƒ€ì„ë¼ì¸ ë Œë”ë§
                timelineNav.innerHTML = '';
                caseFiles.forEach((file, index) => {
                    const item = document.createElement('div');
                    item.className = `timeline-item flex-1 p-3 md:p-4 rounded-lg shadow-md bg-white border border-slate-200 text-center ${index === currentPhaseIndex ? 'active' : ''}`;
                    item.dataset.index = index;
                    item.innerHTML = `
                        <div class="text-3xl mb-1">${file.icon}</div>
                        <div class="font-bold text-sm md:text-base">${file.title}</div>
                        <div class="timeline-phase text-xs text-slate-500">${file.phase}</div>
                    `;
                    timelineNav.appendChild(item);
                });

                // ì½˜í…ì¸  ë Œë”ë§
                const file = caseFiles[currentPhaseIndex];
                contentArea.innerHTML = '';
                const contentDiv = document.createElement('div');
                contentDiv.className = 'content-fade-in bg-white p-6 md:p-8 rounded-lg shadow-lg border border-slate-200';
                
                let investigationItems = file.content.investigation
                    .map(item => `<li class="flex items-start"><span class="mr-2 text-blue-500">â†’</span><span>${item}</span></li>`)
                    .join('');

                contentDiv.innerHTML = `
                    <h2 class="text-2xl font-bold mb-4 text-slate-900">${file.icon} ${file.title}</h2>
                    <div class="space-y-6">
                        <div>
                            <h3 class="font-semibold text-lg text-red-600 mb-2">ì¦ìƒ</h3>
                            <p class="text-slate-700">${file.content.symptom}</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg text-yellow-600 mb-2">ì´ˆê¸° ê°€ì„¤ / ì‹œë„</h3>
                            <p class="text-slate-700">${file.content.hypothesis}</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg text-blue-600 mb-2">ìˆ˜ì‚¬ ë° ë‹¨ì„œ (ì‹œí–‰ì°©ì˜¤ í¬í•¨)</h3>
                            <ul class="space-y-2 text-slate-700">${investigationItems}</ul>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg text-green-600 mb-2">ê²°ì •ì  ëŒíŒŒêµ¬ / ê²°ë¡ </h3>
                            <p class="text-slate-700 font-medium">${file.content.breakthrough}</p>
                        </div>
                    </div>
                `;
                contentArea.appendChild(contentDiv);
            }
            
            timelineNav.addEventListener('click', (e) => {
                const target = e.target.closest('.timeline-item');
                if (target && target.dataset.index) {
                    currentPhaseIndex = parseInt(target.dataset.index, 10);
                    render();
                }
            });

            // ì´ˆê¸° ë Œë”ë§
            render();
        });
    </script>

</body>
</html>