<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ê±´ íŒŒì¼: Redis ìºì‹±ê³¼ JPA ì˜ì†ì„± ì¶©ëŒ í•´ê²°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f1f5f9;
        }
        .timeline-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .timeline-item.active {
            background-color: #3b82f6; /* Blue */
            color: white;
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .timeline-item.active .timeline-phase {
            color: white;
        }
        .timeline-item:not(.active):hover {
            background-color: #dbeafe;
            transform: translateY(-2px);
        }
        .content-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            font-family: 'Courier New', Courier, monospace;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="text-slate-800">

    <main class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">ì‚¬ê±´ íŒŒì¼: Redis ìºì‹±ê³¼ JPA ì˜ì†ì„± ì¶©ëŒ</h1>
            <p class="mt-2 text-lg text-slate-600">ì„±ëŠ¥ ìµœì í™” ê³¼ì •ì—ì„œ ë°œìƒí•œ ì§ë ¬í™” ë° ì˜ì†ì„± ì „ì´ ì˜¤ë¥˜ í•´ê²° ê¸°ë¡.</p>
        </header>

        <nav id="timeline-nav" class="flex flex-col md:flex-row justify-center items-center gap-2 md:gap-4 mb-12">
            </nav>

        <div id="content-area">
            </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const timelineNav = document.getElementById('timeline-nav');
            const contentArea = document.getElementById('content-area');
            let currentPhaseIndex = 0;

            const caseFiles = [
                {
                    phase: "1ë‹¨ê³„",
                    title: "ì¸ë±ìŠ¤ êµ¬ì¶•ê³¼ íƒ€ì… ì¶©ëŒ",
                    icon: "ğŸ’¥",
                    content: {
                        symptom: "ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ Redisì— í‚¤ì›Œë“œ ì—­ì¸ë±ìŠ¤(Reverse Index)ë¥¼ êµ¬ì¶•í•˜ëŠ” ê³¼ì •ì—ì„œ, `Long` íƒ€ì… IDê°€ `Integer`ë¡œ ì—­ì§ë ¬í™”ë˜ì–´ <code class='code-block'>java.lang.ClassCastException</code>ì´ ë°œìƒ.",
                        hypothesis: "RedisTemplateì´ ì‚¬ìš©í•˜ëŠ” Jackson2JsonRedisSerializerì˜ ê¸°ë³¸ ì„¤ì • ë¬¸ì œ.",
                        investigation: [
                            "Redisì— ì €ì¥ëœ ìˆ«ìëŠ” JSONì—ì„œ íƒ€ì… ì •ë³´ê°€ ì‚¬ë¼ì§€ë¯€ë¡œ, Jacksonì´ ì„ì˜ë¡œ ì‘ì€ ìˆ«ìëŠ” `Integer`ë¡œ ì½ê³  ìˆì—ˆìŒì„ í™•ì¸.",
                            "ì˜ëª»ëœ Redis ìë£Œêµ¬ì¡°(`opsForSet` ì €ì¥, `opsForValue` ì¡°íšŒ) ì ‘ê·¼ ì¶©ëŒ ë¬¸ì œ í•´ê²°.",
                            "Redisì— ì €ì¥ëœ í‚¤ë¥¼ JVM ë©”ëª¨ë¦¬(`Set/List`)ë¡œ ë¡œë”©í•˜ì—¬ ë°˜ë³µí•˜ëŠ” **ê¸´ ë¬¸ìì—´ ìš°ì„  ë§¤ì¹­ ë¡œì§**ì„ êµ¬í˜„."
                        ],
                        breakthrough: "<code>RedisTemplate</code>ì— <code>Jackson2JsonRedisSerializer</code>ë¥¼ ì ìš©í•˜ê³ , <code>ObjectMapper</code>ì— <code>ToStringSerializer</code> ëª¨ë“ˆì„ ë“±ë¡í•˜ì—¬ **<code>Long</code> íƒ€ì…ì„ ë¬¸ìì—´ë¡œ ê°•ì œ ë³€í™˜**í•¨ìœ¼ë¡œì¨ íƒ€ì… ë¶ˆì¼ì¹˜ ë¬¸ì œë¥¼ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°."
                    }
                },
                {
                    phase: "2ë‹¨ê³„",
                    title: "í”„ë¡ì‹œì™€ ì„¸ì…˜ì˜ ì¶©ëŒ",
                    icon: "ğŸ‘»",
                    content: {
                        symptom: "<code>Long</code> íƒ€ì… ë¬¸ì œê°€ í•´ê²°ëœ í›„, ì—”í‹°í‹° ì €ì¥/ì¡°íšŒ ì‹œ <code class='code-block'>failed to lazily initialize a collection: no Session</code> ì˜¤ë¥˜ê°€ ë°œìƒ.",
                        hypothesis: "Redisì—ì„œ ë¡œë“œëœ ì—”í‹°í‹°ê°€ JPA ì„¸ì…˜ ë°–(Detached) ìƒíƒœì´ê³ , Jacksonì´ ì—”í‹°í‹° ë‚´ë¶€ì˜ <code>@LAZY</code> í”„ë¡ì‹œ í•„ë“œì— ì ‘ê·¼í•˜ì—¬ ë°œìƒí•˜ëŠ” ì§ë ¬í™” ì˜¤ë¥˜.",
                        investigation: [
                            "<code>ItemToKeyword</code> ë‚´ <code>materials</code> í•„ë“œ(`@ManyToMany(EAGER)`)ê°€ í”„ë¡ì‹œ ê°ì²´ë¥¼ ì”ì¡´ì‹œí‚¤ê³  ìˆìŒì„ í™•ì¸.",
                            "<code>RedisConfig</code>ì˜ <code>ObjectMapper</code>ì— <code>Hibernate6Module</code>ì„ ë“±ë¡í•˜ì—¬, Jacksonì´ ì§ë ¬í™” ì‹œ Hibernate í”„ë¡ì‹œ í•„ë“œë¥¼ ìë™ìœ¼ë¡œ ë¬´ì‹œí•˜ë„ë¡ ì„¤ì •."
                        ],
                        breakthrough: "<code>Hibernate6Module</code> ì„¤ì •ê³¼ <code>@JsonIdentityInfo</code> (ìˆœí™˜ ì°¸ì¡° ë°©ì§€)ë¥¼ ì¡°í•©í•˜ì—¬ ì§ë ¬í™” ì‹œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ì•ˆì „í•˜ê²Œ ìš°íšŒ. ê·¸ëŸ¬ë‚˜ ì´ ì„¤ì •ë§Œìœ¼ë¡œëŠ” ë°ì´í„° ìœ ì‹¤ ê°€ëŠ¥ì„±ì´ ì”ì¡´í•˜ì—¬ **DTO ë³€í™˜ ì „ëµ**ìœ¼ë¡œ ì „í™˜ ê²°ì •."
                    }
                },
                {
                    phase: "3ë‹¨ê³„",
                    title: "ì˜ì†ì„± ì „ì´ ì˜¤ë¥˜ í•´ê²°",
                    icon: "ğŸ”—",
                    content: {
                        symptom: "ì—”í‹°í‹° ì €ì¥ ë¡œì§ì—ì„œ <code class='code-block'>TransientObjectException</code> (unsaved transient instance) ì˜¤ë¥˜ê°€ ì—°ì‡„ì ìœ¼ë¡œ ë°œìƒ.",
                        hypothesis: "ìì‹ ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ, ë¶€ëª¨ ì—”í‹°í‹°(ë˜ëŠ” ì—°ê´€ ì—”í‹°í‹°)ê°€ ì•„ì§ DBì— ì €ì¥ë˜ì§€ ì•Šì€ <code>Transient</code> ìƒíƒœì´ê¸° ë•Œë¬¸ì— JPAê°€ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚´.",
                        investigation: [
                            "<code>RecycleMatchItem</code>, <code>MatchItemComposition</code> ë“± ëª¨ë“  ìì‹ ì—”í‹°í‹°ê°€ ì°¸ì¡°í•˜ëŠ” ë¶€ëª¨ ì—”í‹°í‹°ì˜ <code>@ManyToOne</code> í•„ë“œ í™•ì¸.",
                            "ë¶€ëª¨ ì—”í‹°í‹°ê°€ ìƒˆ ê°ì²´ì¼ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ëª¨ë“  <code>@ManyToOne</code> ê´€ê³„ í•„ë“œì— <code>cascade = CascadeType.PERSIST</code>ë¥¼ ì¶”ê°€.",
                            "ë¶€ëª¨ ì—”í‹°í‹°ì˜ <code>@OneToMany</code> í•„ë“œì— <code>cascade = CascadeType.ALL</code> ë° <code>orphanRemoval = true</code>ë¥¼ ì ìš©í•˜ì—¬ ìƒëª…ì£¼ê¸° ê´€ë¦¬ í†µì¼."
                        ],
                        breakthrough: "<code>CascadeType.PERSIST</code> ì„¤ì •ì„ í†µí•´ ìì‹ ì—”í‹°í‹° ì €ì¥ ì‹œ ë¶€ëª¨ ì—”í‹°í‹°ë„ ìë™ìœ¼ë¡œ ì˜ì†í™”ë˜ë„ë¡ ì „íŒŒí•˜ì—¬ <code>TransientObjectException</code> ì˜¤ë¥˜ë¥¼ ì™„ì „íˆ í•´ê²°."
                    }
                },
                {
                    phase: "4ë‹¨ê³„",
                    title: "ìµœì¢… ì•„í‚¤í…ì²˜ í™•ë¦½",
                    icon: "ğŸ“",
                    content: {
                        symptom: "ëª¨ë“  ë¬¸ì œ í•´ê²° í›„ì—ë„ **ì„±ëŠ¥ ë° ì•ˆì •ì„±** ë¬¸ì œë¥¼ ì•¼ê¸°í•˜ëŠ” Detached Entity ë¬¸ì œ ì§€ì†.",
                        hypothesis: "ìºì‹œ ê³„ì¸µì´ Entityë¥¼ ë°˜í™˜í•˜ì—¬ Detached Entity ë¬¸ì œë¥¼ ìœ ë°œí•˜ë©°, ì´ëŠ” ì—­í•  ë¶„ë¦¬ ì›ì¹™ì— ìœ„ë°°ë¨.",
                        investigation: [
                            "ìºì‹œ <code>RedisTemplate</code>ì˜ íƒ€ì…ì„ <code>ItemToKeywordDto</code>ë¡œ ë³€ê²½.",
                            "<code>ItemCacheService</code>ì— <code>@Transactional</code> í™˜ê²½ ë‚´ì—ì„œ Entityë¥¼ <code>DTO</code>ë¡œ ë³€í™˜í•˜ëŠ” ë¡œì§ êµ¬í˜„.",
                            "ìµœì¢… ì €ì¥ ì„œë¹„ìŠ¤ì—ì„œ <code>DTO</code>ë¥¼ ë‹¤ì‹œ <code>Entity</code>ë¡œ ë³€í™˜í•œ í›„, <code>entityManager.merge(detachedEntity)</code>ë¥¼ í†µí•´ JPA ì„¸ì…˜ì— **ì¬ì—°ê²°**í•˜ëŠ” í”Œë¡œìš° í™•ë¦½."
                        ],
                        breakthrough: "DTO ìºì‹± êµ¬ì¡°ë¥¼ í™•ë¦½í•˜ì—¬ **ì§ë ¬í™” ë¬¸ì œì™€ Detached Entity ë¬¸ì œë¥¼ ì™„ë²½íˆ ë¶„ë¦¬**í•˜ê³ , <code>merge()</code>ë¥¼ í†µí•œ ì˜ì†ì„± ì¬ì—°ê²° ë¡œì§ìœ¼ë¡œ DB ì €ì¥ì˜ ì•ˆì „ì„±ì„ ê·¹ëŒ€í™”."
                    }
                }
            ];

            function render() {
                // íƒ€ì„ë¼ì¸ ë Œë”ë§
                timelineNav.innerHTML = '';
                caseFiles.forEach((file, index) => {
                    const item = document.createElement('div');
                    item.className = `timeline-item flex-1 p-3 md:p-4 rounded-lg shadow-md bg-white border border-slate-200 text-center ${index === currentPhaseIndex ? 'active' : ''}`;
                    item.dataset.index = index;
                    item.innerHTML = `
                        <div class="text-3xl mb-1">${file.icon}</div>
                        <div class="font-bold text-sm md:text-base">${file.title}</div>
                        <div class="timeline-phase text-xs text-slate-500">${file.phase}</div>
                    `;
                    timelineNav.appendChild(item);
                });

                // ì½˜í…ì¸  ë Œë”ë§
                const file = caseFiles[currentPhaseIndex];
                contentArea.innerHTML = '';
                const contentDiv = document.createElement('div');
                contentDiv.className = 'content-fade-in bg-white p-6 md:p-8 rounded-lg shadow-lg border border-slate-200';
                
                let investigationItems = file.content.investigation
                    .map(item => `<li class="flex items-start"><span class="mr-2 text-blue-500">â€¢</span><span>${item}</span></li>`)
                    .join('');

                contentDiv.innerHTML = `
                    <h2 class="text-2xl font-bold mb-4 text-slate-900">${file.icon} ${file.title}</h2>
                    <div class="space-y-6">
                        <div>
                            <h3 class="font-semibold text-lg text-red-600 mb-2">ì¦ìƒ</h3>
                            <p class="text-slate-700">${file.content.symptom}</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg text-yellow-600 mb-2">ì´ˆê¸° ê°€ì„¤</h3>
                            <p class="text-slate-700">${file.content.hypothesis}</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg text-blue-600 mb-2">ìˆ˜ì‚¬ ë° ë‹¨ì„œ (ë””ë²„ê¹… ê³¼ì •)</h3>
                            <ul class="space-y-2 text-slate-700">${investigationItems}</ul>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg text-green-600 mb-2">ê²°ì •ì  ëŒíŒŒêµ¬ / ìµœì¢… í•´ê²°ì±…</h3>
                            <p class="text-slate-700 font-medium">${file.content.breakthrough}</p>
                        </div>
                    </div>
                `;
                contentArea.appendChild(contentDiv);
            }
            
            timelineNav.addEventListener('click', (e) => {
                const target = e.target.closest('.timeline-item');
                if (target && target.dataset.index) {
                    currentPhaseIndex = parseInt(target.dataset.index, 10);
                    render();
                }
            });

            // ì´ˆê¸° ë Œë”ë§
            render();
        });
    </script>

</body>
</html>